<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Vumbua eFootball</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* (Keep your existing CSS exactly as provided ‚Äì no changes needed) */
        :root {
            --neon: #00ff41;
            --neon-dim: rgba(0,255,65,0.08);
            --bg: #060608;
            --surface: #0c0c0f;
            --card: #111116;
            --card2: #161619;
            --border: rgba(255,255,255,0.06);
            --text: #f0f0f0;
            --muted: #666;
            --danger: #ff4444;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--bg); color: var(--text); font-family: 'Outfit', sans-serif; min-height: 100vh; overflow-x: hidden; }
        #loading-screen {
            position: fixed; inset: 0; z-index: 1000; background: var(--bg);
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 16px;
        }
        .spinner {
            width: 36px; height: 36px; border: 2px solid rgba(0,255,65,0.15);
            border-top-color: var(--neon); border-radius: 50%; animation: spin 0.7s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 0.75rem; letter-spacing: 3px; color: var(--muted); text-transform: uppercase; }
        .pitch-bg {
            position: fixed; inset: 0; z-index: 0;
            background: radial-gradient(ellipse 60% 40% at 70% 0%, rgba(0,255,65,0.04) 0%, transparent 55%);
        }
        .pitch-lines {
            position: fixed; inset: 0; z-index: 0; opacity: 0.025;
            background-image:
                repeating-linear-gradient(0deg, transparent, transparent 79px, rgba(0,255,65,0.8) 80px),
                repeating-linear-gradient(90deg, transparent, transparent 79px, rgba(0,255,65,0.8) 80px);
            animation: gridDrift 25s linear infinite;
        }
        @keyframes gridDrift { 0% { transform: translateY(0); } 100% { transform: translateY(80px); } }
        .app {
            position: relative; z-index: 1; max-width: 480px; margin: 0 auto;
            padding: 0 0 80px 0; min-height: 100vh;
            animation: fadeIn 0.5s ease both;
        }
        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
        .topnav {
            display: flex; align-items: center; justify-content: space-between;
            padding: 20px 20px 16px;
            position: sticky; top: 0; z-index: 10;
            background: linear-gradient(to bottom, var(--bg) 70%, transparent);
        }
        .nav-logo { font-family: 'Bebas Neue', sans-serif; font-size: 1.8rem; letter-spacing: 4px; color: var(--neon); }
        .nav-right { display: flex; align-items: center; gap: 10px; }
        .nav-user {
            display: flex; align-items: center; gap: 8px;
            background: var(--card); border: 1px solid var(--border);
            padding: 7px 14px; border-radius: 20px;
        }
        .avatar {
            width: 26px; height: 26px; border-radius: 50%;
            background: var(--neon); color: #000; display: flex; align-items: center;
            justify-content: center; font-size: 0.7rem; font-weight: 800;
        }
        .nav-username { font-size: 0.82rem; color: var(--neon); font-weight: 600; }
        .btn-logout {
            background: none; border: 1px solid var(--border); color: var(--muted);
            padding: 7px 12px; border-radius: 20px; cursor: pointer; font-size: 0.75rem;
            font-family: 'Outfit', sans-serif; transition: border-color 0.2s, color 0.2s;
        }
        .btn-logout:hover { border-color: rgba(255,68,68,0.4); color: #ff8888; }
        .content { padding: 0 16px; }
        .wallet-card {
            background: linear-gradient(135deg, #111116 0%, #0d1a12 100%);
            border: 1px solid rgba(0,255,65,0.15);
            border-radius: 22px; padding: 28px;
            position: relative; overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5), inset 0 1px 0 rgba(0,255,65,0.1);
            margin-bottom: 20px;
            animation: slideUp 0.5s 0.1s ease both;
        }
        @keyframes slideUp { from { opacity:0; transform:translateY(16px); } to { opacity:1; transform:translateY(0); } }
        .wallet-card::before {
            content: ''; position: absolute; top: -60px; right: -60px;
            width: 200px; height: 200px; border-radius: 50%;
            background: radial-gradient(circle, rgba(0,255,65,0.08) 0%, transparent 70%);
        }
        .wallet-card::after {
            content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(to right, transparent, rgba(0,255,65,0.2), transparent);
        }
        .wallet-label { font-size: 0.65rem; letter-spacing: 3px; text-transform: uppercase; color: #555; margin-bottom: 10px; }
        .wallet-amount {
            font-family: 'Bebas Neue', sans-serif; font-size: 3.5rem;
            color: var(--neon); line-height: 1;
            text-shadow: 0 0 40px rgba(0,255,65,0.3);
        }
        .wallet-currency { font-size: 1.5rem; opacity: 0.6; margin-right: 4px; }
        .wallet-meta { margin-top: 16px; display: flex; justify-content: space-between; align-items: flex-end; }
        .wallet-phone { font-size: 0.72rem; color: #444; }
        .wallet-phone span { color: #666; }
        .wallet-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 28px; animation: slideUp 0.5s 0.15s ease both; }
        .btn-action {
            padding: 14px; border-radius: 14px; border: none; font-weight: 700;
            font-size: 0.85rem; letter-spacing: 1px; cursor: pointer; font-family: 'Outfit', sans-serif;
            transition: transform 0.15s, box-shadow 0.15s, opacity 0.15s;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-action:hover { transform: translateY(-2px); }
        .btn-action:active { transform: translateY(0); opacity: 0.85; }
        .btn-deposit { background: var(--neon); color: #000; box-shadow: 0 6px 20px rgba(0,255,65,0.2); }
        .btn-deposit:hover { box-shadow: 0 10px 30px rgba(0,255,65,0.35); }
        .btn-withdraw { background: var(--card2); color: var(--text); border: 1px solid var(--border); }
        .section-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 14px; animation: slideUp 0.5s 0.2s ease both;
        }
        .section-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.4rem; letter-spacing: 2px; }
        .section-link { font-size: 0.78rem; color: var(--neon); cursor: pointer; font-weight: 500; }
        .quick-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 28px; animation: slideUp 0.5s 0.25s ease both; }
        .quick-card {
            background: var(--card); border: 1px solid var(--border);
            border-radius: 16px; padding: 18px 12px; text-align: center;
            cursor: pointer; transition: border-color 0.2s, transform 0.2s;
        }
        .quick-card:hover { border-color: rgba(0,255,65,0.3); transform: translateY(-2px); }
        .quick-icon { font-size: 1.5rem; margin-bottom: 8px; display: block; }
        .quick-label { font-size: 0.72rem; font-weight: 600; color: #ccc; letter-spacing: 0.5px; }
        .tournaments { animation: slideUp 0.5s 0.3s ease both; margin-bottom: 28px; }
        .tournament-card {
            background: var(--card); border: 1px solid var(--border);
            border-radius: 16px; padding: 18px; margin-bottom: 10px;
            cursor: pointer; transition: border-color 0.2s, transform 0.2s;
            position: relative; overflow: hidden;
        }
        .tournament-card:hover { border-color: rgba(0,255,65,0.25); transform: translateY(-1px); }
        .tournament-card.live::before {
            content: ''; position: absolute; left: 0; top: 0; bottom: 0;
            width: 3px; background: var(--neon);
            box-shadow: 0 0 10px rgba(0,255,65,0.5);
        }
        .t-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .t-badge {
            display: inline-flex; align-items: center; gap: 5px;
            padding: 4px 10px; border-radius: 20px; font-size: 0.65rem;
            font-weight: 700; letter-spacing: 1px; text-transform: uppercase;
        }
        .t-badge.live-badge { background: rgba(0,255,65,0.1); color: var(--neon); border: 1px solid rgba(0,255,65,0.2); }
        .t-badge.soon-badge { background: rgba(255,180,0,0.1); color: #ffb400; border: 1px solid rgba(255,180,0,0.2); }
        .live-pip { width: 6px; height: 6px; background: var(--neon); border-radius: 50%; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.3;} }
        .t-name { font-weight: 700; font-size: 1rem; margin-bottom: 4px; }
        .t-meta { font-size: 0.78rem; color: var(--muted); }
        .t-footer { display: flex; justify-content: space-between; align-items: center; }
        .t-prize { font-family: 'Bebas Neue', sans-serif; font-size: 1.4rem; color: var(--neon); letter-spacing: 1px; }
        .t-prize small { font-family: 'Outfit', sans-serif; font-size: 0.65rem; color: var(--muted); font-weight: 400; display: block; letter-spacing: 0; margin-bottom: 1px; }
        .t-players { font-size: 0.75rem; color: var(--muted); display: flex; align-items: center; gap: 5px; }
        .progress-bar { height: 4px; background: rgba(255,255,255,0.06); border-radius: 4px; margin-top: 12px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--neon); border-radius: 4px; transition: width 0.5s ease; }
        .btn-join {
            padding: 9px 20px; border-radius: 10px; background: var(--neon); color: #000;
            border: none; font-weight: 700; font-size: 0.78rem; cursor: pointer;
            font-family: 'Outfit', sans-serif; letter-spacing: 1px;
            transition: transform 0.15s, box-shadow 0.15s;
        }
        .btn-join:hover { transform: translateY(-1px); box-shadow: 0 5px 15px rgba(0,255,65,0.3); }
        .friend-section { animation: slideUp 0.5s 0.35s ease both; margin-bottom: 24px; }
        .friend-card {
            background: var(--card); border: 1px solid var(--border);
            border-radius: 16px; padding: 20px; text-align: center;
        }
        .generated-code {
            font-family: 'Bebas Neue', sans-serif; font-size: 2.8rem;
            letter-spacing: 8px; color: var(--neon);
            text-shadow: 0 0 20px rgba(0,255,65,0.3);
            margin: 12px 0;
        }
        .code-placeholder { font-size: 0.85rem; color: #444; margin: 14px 0; }
        .btn-gen {
            background: rgba(255,255,255,0.05); border: 1px solid var(--border);
            color: var(--text); padding: 11px 22px; border-radius: 10px;
            font-weight: 600; font-size: 0.82rem; cursor: pointer; font-family: 'Outfit', sans-serif;
            transition: border-color 0.2s;
        }
        .btn-gen:hover { border-color: rgba(0,255,65,0.3); }
        .btn-whatsapp {
            background: #25D366; color: white; border: none; padding: 12px;
            border-radius: 10px; font-weight: 700; font-size: 0.85rem; cursor: pointer;
            width: 100%; margin-top: 12px; font-family: 'Outfit', sans-serif;
            transition: transform 0.15s, box-shadow 0.15s;
        }
        .btn-whatsapp:hover { transform: translateY(-1px); box-shadow: 0 5px 15px rgba(37,211,102,0.3); }
        .bottom-nav {
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 100%; max-width: 480px;
            background: rgba(10,10,14,0.92); backdrop-filter: blur(12px);
            border-top: 1px solid var(--border); padding: 10px 0;
            display: grid; grid-template-columns: repeat(4, 1fr); z-index: 10;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center;
            gap: 3px; padding: 6px; cursor: pointer; opacity: 0.45;
            transition: opacity 0.2s;
        }
        .nav-item.active { opacity: 1; }
        .nav-item svg { width: 20px; height: 20px; stroke: currentColor; fill: none; stroke-width: 2; }
        .nav-item.active svg { stroke: var(--neon); }
        .nav-item-label { font-size: 0.62rem; letter-spacing: 0.5px; text-transform: uppercase; font-weight: 600; }
        .nav-item.active .nav-item-label { color: var(--neon); }
        .modal-overlay {
            position: fixed; inset: 0; z-index: 500;
            background: rgba(0,0,0,0.75); backdrop-filter: blur(6px);
            display: flex; align-items: flex-end; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.25s ease;
        }
        .modal-overlay.open { opacity: 1; pointer-events: all; }
        .modal-sheet {
            background: #0f0f13; border: 1px solid var(--border);
            border-radius: 24px 24px 0 0; width: 100%; max-width: 480px;
            padding: 28px 24px 48px;
            transform: translateY(40px); transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1);
            position: relative;
        }
        .modal-overlay.open .modal-sheet { transform: translateY(0); }
        .modal-handle {
            width: 36px; height: 4px; background: #2a2a2a; border-radius: 4px;
            margin: 0 auto 24px;
        }
        .modal-step { display: none; }
        .modal-step.active { display: block; }
        .step-icon {
            width: 56px; height: 56px; border-radius: 50%; margin: 0 auto 16px;
            display: flex; align-items: center; justify-content: center; font-size: 1.6rem;
        }
        .step-icon.mpesa { background: rgba(0,150,80,0.15); border: 1px solid rgba(0,200,100,0.2); }
        .step-icon.waiting { background: rgba(0,255,65,0.07); border: 1px solid rgba(0,255,65,0.15); }
        .step-icon.success { background: rgba(0,255,65,0.1); border: 1px solid rgba(0,255,65,0.3); }
        .step-icon.failed { background: rgba(255,68,68,0.1); border: 1px solid rgba(255,68,68,0.25); }
        .modal-title {
            font-family: 'Bebas Neue', sans-serif; font-size: 1.8rem;
            letter-spacing: 2px; text-align: center; margin-bottom: 6px;
        }
        .modal-subtitle { font-size: 0.85rem; color: var(--muted); text-align: center; margin-bottom: 24px; line-height: 1.5; }
        .amount-presets { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 16px; }
        .preset-btn {
            padding: 10px 6px; background: var(--card); border: 1px solid var(--border);
            color: var(--text); border-radius: 10px; font-size: 0.8rem; font-weight: 600;
            cursor: pointer; font-family: 'Outfit', sans-serif; text-align: center;
            transition: border-color 0.15s, background 0.15s;
        }
        .preset-btn:hover, .preset-btn.selected {
            border-color: rgba(0,255,65,0.5); background: rgba(0,255,65,0.07); color: var(--neon);
        }
        .modal-input-group { margin-bottom: 14px; }
        .modal-input-group label {
            display: block; font-size: 0.68rem; letter-spacing: 2px;
            text-transform: uppercase; color: var(--muted); margin-bottom: 6px; font-weight: 600;
        }
        .modal-input {
            width: 100%; background: var(--card); border: 1px solid var(--border);
            color: var(--text); padding: 13px 16px; border-radius: 10px;
            font-size: 1rem; font-family: 'Outfit', sans-serif;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .modal-input:focus { outline: none; border-color: rgba(0,255,65,0.45); box-shadow: 0 0 0 3px rgba(0,255,65,0.07); }
        .modal-input::placeholder { color: #333; }
        .modal-notice {
            background: rgba(0,150,80,0.07); border: 1px solid rgba(0,200,100,0.15);
            border-radius: 10px; padding: 12px 14px; font-size: 0.78rem; color: #aaa;
            margin-bottom: 18px; line-height: 1.5;
        }
        .modal-notice strong { color: #00cc55; }
        .btn-mpesa {
            width: 100%; padding: 15px; border-radius: 12px; border: none;
            background: #00a651; color: white; font-weight: 800; font-size: 0.9rem;
            letter-spacing: 1px; cursor: pointer; font-family: 'Outfit', sans-serif;
            transition: transform 0.15s, box-shadow 0.15s, opacity 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-mpesa:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,166,81,0.35); }
        .btn-mpesa:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-cancel {
            width: 100%; padding: 13px; margin-top: 10px; border-radius: 12px;
            border: 1px solid var(--border); background: none; color: var(--muted);
            font-size: 0.85rem; cursor: pointer; font-family: 'Outfit', sans-serif;
            transition: color 0.2s, border-color 0.2s;
        }
        .btn-cancel:hover { color: var(--text); border-color: #444; }
        .wait-ring {
            width: 64px; height: 64px; border-radius: 50%; margin: 0 auto 16px;
            border: 3px solid rgba(0,255,65,0.1); border-top-color: var(--neon);
            animation: spin 0.9s linear infinite;
        }
        .wait-dots span {
            display: inline-block; width: 6px; height: 6px; background: var(--neon);
            border-radius: 50%; margin: 0 3px; opacity: 0.3;
            animation: dotFade 1.2s infinite;
        }
        .wait-dots span:nth-child(2) { animation-delay: 0.2s; }
        .wait-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes dotFade { 0%,80%,100%{opacity:0.2;} 40%{opacity:1;} }
        .modal-error { color: #ff7777; font-size: 0.82rem; text-align: center; margin-top: 10px; display: none; }
        .success-amount {
            font-family: 'Bebas Neue', sans-serif; font-size: 3rem; color: var(--neon);
            text-align: center; text-shadow: 0 0 30px rgba(0,255,65,0.3);
            margin-bottom: 6px;
        }
        .btn-done {
            width: 100%; padding: 15px; border-radius: 12px; border: none;
            background: var(--neon); color: #000; font-weight: 800; font-size: 0.9rem;
            letter-spacing: 2px; cursor: pointer; font-family: 'Outfit', sans-serif;
            margin-top: 20px; transition: transform 0.15s, box-shadow 0.15s;
        }
        .btn-done:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,255,65,0.3); }
        @keyframes balanceFlash {
            0% { color: var(--neon); text-shadow: 0 0 40px rgba(0,255,65,0.8); transform: scale(1.08); }
            60% { color: #fff; text-shadow: 0 0 20px rgba(255,255,255,0.3); }
            100% { color: var(--neon); text-shadow: 0 0 40px rgba(0,255,65,0.3); transform: scale(1); }
        }
        .balance-flash { animation: balanceFlash 0.8s ease forwards; display: inline-block; }
        #challenge-modal .modal-sheet { max-height: 90vh; overflow-y: auto; }
        .stake-presets { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 16px; }
        .match-details-box {
            background: rgba(0,255,65,0.04); border: 1px solid rgba(0,255,65,0.12);
            border-radius: 14px; padding: 16px; margin-bottom: 18px;
        }
        .match-detail-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 7px 0; border-bottom: 1px solid rgba(255,255,255,0.04);
        }
        .match-detail-row:last-child { border-bottom: none; padding-bottom: 0; }
        .match-detail-label { font-size: 0.72rem; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; }
        .match-detail-value { font-size: 0.88rem; font-weight: 700; color: var(--text); }
        .match-detail-value.neon { color: var(--neon); font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 1px; }
        .vs-divider {
            display: flex; align-items: center; gap: 12px; margin: 16px 0;
            font-family: 'Bebas Neue', sans-serif; font-size: 1rem; color: var(--muted);
        }
        .vs-divider::before, .vs-divider::after { content:''; flex:1; height:1px; background: var(--border); }
        .room-reveal-box {
            background: linear-gradient(135deg, #0d1a12, #111116);
            border: 1px solid rgba(0,255,65,0.25); border-radius: 16px;
            padding: 20px; text-align: center; margin-bottom: 18px;
            box-shadow: 0 0 30px rgba(0,255,65,0.06);
        }
        .room-code-display {
            font-family: 'Bebas Neue', sans-serif; font-size: 3rem;
            letter-spacing: 10px; color: var(--neon);
            text-shadow: 0 0 30px rgba(0,255,65,0.4);
            margin: 10px 0;
        }
        .room-code-hint { font-size: 0.75rem; color: #555; margin-top: 4px; }
        .balance-insufficient {
            background: rgba(255,68,68,0.08); border: 1px solid rgba(255,68,68,0.2);
            border-radius: 10px; padding: 12px 14px; font-size: 0.82rem; color: #ff8888;
            margin-bottom: 14px; display: none; text-align: center;
        }
        .withdraw-info-box {
            background: rgba(255,180,0,0.05); border: 1px solid rgba(255,180,0,0.15);
            border-radius: 12px; padding: 14px 16px; margin-bottom: 16px;
        }
        .withdraw-info-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.04); font-size: 0.82rem;
        }
        .withdraw-info-row:last-child { border-bottom: none; padding-bottom: 0; }
        .withdraw-info-label { color: var(--muted); }
        .withdraw-info-value { font-weight: 700; color: var(--text); }
        .withdraw-info-value.warn { color: #ffb400; }
        .withdraw-steps {
            background: var(--card); border: 1px solid var(--border);
            border-radius: 12px; padding: 14px 16px; margin-bottom: 18px;
        }
        .withdraw-step-item {
            display: flex; gap: 12px; align-items: flex-start;
            padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.03);
        }
        .withdraw-step-item:last-child { border-bottom: none; }
        .step-num {
            width: 22px; height: 22px; background: rgba(0,255,65,0.1);
            border: 1px solid rgba(0,255,65,0.25); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.65rem; font-weight: 800; color: var(--neon); flex-shrink: 0; margin-top: 1px;
        }
        .step-text { font-size: 0.8rem; color: #aaa; line-height: 1.4; }
        .step-text strong { color: var(--text); }
        .btn-submit-withdraw {
            width: 100%; padding: 15px; border-radius: 12px; border: none;
            background: #ffb400; color: #000; font-weight: 800; font-size: 0.9rem;
            letter-spacing: 1px; cursor: pointer; font-family: 'Outfit', sans-serif;
            transition: transform 0.15s, box-shadow 0.15s, opacity 0.2s;
        }
        .btn-submit-withdraw:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(255,180,0,0.3); }
        .btn-submit-withdraw:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        .pending-card {
            background: linear-gradient(135deg, #141408, #111116);
            border: 1px solid rgba(255,180,0,0.2); border-radius: 16px;
            padding: 20px; text-align: center; margin-bottom: 18px;
        }
        .pending-ref { font-family: 'Bebas Neue', sans-serif; font-size: 1.6rem; letter-spacing: 4px; color: #ffb400; margin: 8px 0; }
        .pending-amount-display { font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; color: #ffb400; text-shadow: 0 0 20px rgba(255,180,0,0.3); }
        .eta-badge {
            display: inline-flex; align-items: center; gap: 6px;
            background: rgba(255,180,0,0.08); border: 1px solid rgba(255,180,0,0.2);
            border-radius: 20px; padding: 5px 14px; font-size: 0.72rem; color: #ffb400; margin-top: 10px;
        }
    </style>
</head>
<body>
<div id="loading-screen">
    <div class="spinner"></div>
    <div class="loading-text">Verifying session...</div>
</div>

<div class="pitch-bg"></div>
<div class="pitch-lines"></div>

<div class="app" id="main-content" style="display:none;">
    <nav class="topnav">
        <span class="nav-logo">VUMBUA</span>
        <div class="nav-right">
            <div class="nav-user">
                <div class="avatar" id="avatar-letter">P</div>
                <span class="nav-username" id="username-display">@Player</span>
            </div>
            <button class="btn-logout" id="logoutBtn">Logout</button>
        </div>
    </nav>
    <div class="content">
        <div class="wallet-card">
            <div class="wallet-label">Available Balance</div>
            <div class="wallet-amount">
                <span class="wallet-currency">KES</span><span id="balance">0.00</span>
            </div>
            <div class="wallet-meta">
                <div class="wallet-phone">Linked M-PESA: <span id="phone-display">‚Äî</span></div>
            </div>
        </div>
        <div class="wallet-actions">
            <button class="btn-action btn-deposit" onclick="openDepositModal()">
                <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M12 5v14M5 12l7 7 7-7"/></svg>
                Deposit
            </button>
            <button class="btn-action btn-withdraw" onclick="openWithdrawModal()">
                <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M12 19V5M5 12l7-7 7 7"/></svg>
                Withdraw
            </button>
        </div>

        <div class="section-header">
            <div class="section-title">QUICK PLAY</div>
        </div>
        <div class="quick-grid">
            <div class="quick-card" onclick="document.querySelector('.friend-section').scrollIntoView({behavior: 'smooth'})">
                <span class="quick-icon">‚öîÔ∏è</span>
                <div class="quick-label">Piga Rafiki</div>
            </div>
            <div class="quick-card">
                <span class="quick-icon">üèÜ</span>
                <div class="quick-label">Tournaments</div>
            </div>
            <div class="quick-card">
                <span class="quick-icon">üìä</span>
                <div class="quick-label">Matokeo</div>
            </div>
        </div>

        <div class="tournaments">
            <div class="section-header">
                <div class="section-title">LIVE NOW</div>
                <span class="section-link" onclick="loadTournaments()">Ona zote ‚Üí</span>
            </div>
            <div id="tournament-list">
                <!-- Tournament cards will be dynamically injected here -->
            </div>
        </div>

        <div class="friend-section">
            <div class="section-header">
                <div class="section-title">CHALLENGE RAFIKI</div>
            </div>
            <div class="friend-card">
                <div id="code-display">
                    <div class="code-placeholder">Generate a code and share with your friend to start a 1v1 match.</div>
                    <button class="btn-gen" onclick="generateFriendCode()">‚ö° Generate Code</button>
                </div>
                <div id="code-reveal" style="display:none;">
                    <div style="font-size:0.68rem;letter-spacing:2px;color:var(--muted);text-transform:uppercase;">Your Friend Code</div>
                    <div class="generated-code" id="generated-code">KE-XXXX</div>
                    <div style="font-size:0.75rem;color:#555;margin-bottom:10px;">Share this code ‚Äî expires in 30 minutes</div>
                    <button class="btn-whatsapp" onclick="shareToWhatsApp()">
                        üì≤ Share to WhatsApp
                    </button>
                    <button class="btn-gen" style="margin-top:8px;width:100%;" onclick="generateFriendCode()">‚Üª New Code</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="bottom-nav">
    <div class="nav-item active">
        <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
        <span class="nav-item-label">Home</span>
    </div>
    <div class="nav-item">
        <svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
        <span class="nav-item-label">Chat</span>
    </div>
    <div class="nav-item">
        <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>
        <span class="nav-item-label">Matches</span>
    </div>
    <div class="nav-item">
        <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
        <span class="nav-item-label">Profile</span>
    </div>
</div>

<!-- Deposit Modal -->
<div class="modal-overlay" id="deposit-modal" onclick="handleOverlayClick(event, 'deposit-modal')">
    <div class="modal-sheet">
        <div class="modal-handle"></div>
        
        <div class="modal-step active" id="deposit-step-1">
            <div class="step-icon mpesa">üí≥</div>
            <div class="modal-title">DEPOSIT VIA M-PESA</div>
            <p class="modal-subtitle">Chagua kiasi na utapata prompt ya M-PESA kwenye simu yako moja kwa moja.</p>
            
            <div class="amount-presets" id="deposit-presets">
                <button class="preset-btn" onclick="selectPreset(this, 100)">100</button>
                <button class="preset-btn" onclick="selectPreset(this, 250)">250</button>
                <button class="preset-btn" onclick="selectPreset(this, 500)">500</button>
                <button class="preset-btn" onclick="selectPreset(this, 1000)">1000</button>
            </div>
            
            <div class="modal-input-group">
                <label>Amount (KES)</label>
                <input type="number" id="deposit-amount" class="modal-input" placeholder="Min 50" oninput="clearPresets()">
            </div>
            <div class="modal-input-group">
                <label>M-PESA Number</label>
                <input type="tel" id="deposit-phone" class="modal-input" placeholder="0712345678">
            </div>
            
            <div class="modal-notice">
                Kiasi hiki kitawekwa kwenye wallet yako mara moja. <strong>Minimum KES 50.</strong>
            </div>
            <button class="btn-mpesa" id="depositBtn" onclick="processDeposit()">DEPOSIT NOW</button>
            <button class="btn-cancel" onclick="closeModal('deposit-modal')">Cancel</button>
            <div class="modal-error" id="deposit-error"></div>
        </div>

        <div class="modal-step" id="deposit-step-2">
            <div class="wait-ring"></div>
            <div class="modal-title">WAITING FOR M-PESA</div>
            <p class="modal-subtitle">Please check your phone and enter your M-PESA PIN to authorize the transaction.</p>
            <div class="wait-dots" style="text-align: center; margin-bottom: 20px;">
                <span></span><span></span><span></span>
            </div>
            <button class="btn-cancel" onclick="closeModal('deposit-modal')">Cancel Transaction</button>
        </div>

        <div class="modal-step" id="deposit-step-3">
            <div class="step-icon success">‚úì</div>
            <div class="modal-title">DEPOSIT SUCCESSFUL</div>
            <p class="modal-subtitle">Your wallet has been credited.</p>
            <div class="success-amount">KES <span id="success-deposit-val">0</span></div>
            <button class="btn-done" onclick="closeModal('deposit-modal')">DONE</button>
        </div>

        <div class="modal-step" id="deposit-step-4">
            <div class="step-icon failed">‚úó</div>
            <div class="modal-title">DEPOSIT FAILED</div>
            <p class="modal-subtitle" id="deposit-fail-reason">Transaction was cancelled or failed.</p>
            <button class="btn-done" onclick="closeModal('deposit-modal')">CLOSE</button>
        </div>
    </div>
</div>

<!-- Withdraw Modal -->
<div class="modal-overlay" id="withdraw-modal" onclick="handleOverlayClick(event, 'withdraw-modal')">
    <div class="modal-sheet">
        <div class="modal-handle"></div>
        
        <div class="modal-step active" id="withdraw-step-1">
            <div class="modal-title">WITHDRAW FUNDS</div>
            <p class="modal-subtitle">Toa pesa zako moja kwa moja kwa M-PESA yako.</p>
            
            <div class="withdraw-info-box">
                <div class="withdraw-info-row">
                    <span class="withdraw-info-label">Available Balance</span>
                    <span class="withdraw-info-value">KES <span id="withdraw-max">0</span></span>
                </div>
                <div class="withdraw-info-row">
                    <span class="withdraw-info-label">Withdrawal Fee</span>
                    <span class="withdraw-info-value warn">KES 15.00</span>
                </div>
            </div>

            <div class="modal-input-group">
                <label>Withdraw Amount (KES)</label>
                <input type="number" id="withdraw-amount" class="modal-input" placeholder="Min 100">
            </div>

            <div class="modal-input-group">
                <label>M-PESA Number</label>
                <input type="tel" id="withdraw-phone" class="modal-input" placeholder="0712345678">
            </div>

            <div class="modal-input-group">
                <label>Full Name (as on M-PESA)</label>
                <input type="text" id="withdraw-name" class="modal-input" placeholder="John Doe">
            </div>

            <div class="balance-insufficient" id="withdraw-error"></div>

            <button class="btn-submit-withdraw" id="withdrawBtn" onclick="processWithdraw()">CONFIRM WITHDRAWAL</button>
            <button class="btn-cancel" onclick="closeModal('withdraw-modal')">Cancel</button>
        </div>

        <div class="modal-step" id="withdraw-step-2">
            <div class="pending-card">
                <div class="step-icon waiting" style="color:#ffb400;">‚è≥</div>
                <div class="modal-title" style="color:#ffb400;">WITHDRAWAL INITIATED</div>
                <div class="pending-amount-display">KES <span id="success-withdraw-val">0</span></div>
                <div class="eta-badge">ETA: M-PESA in 2-5 Mins</div>
            </div>
            <button class="btn-done" style="background:#ffb400;" onclick="closeModal('withdraw-modal')">DONE</button>
        </div>
    </div>
</div>

<!-- Challenge Modal -->
<div class="modal-overlay" id="challenge-modal" onclick="handleOverlayClick(event, 'challenge-modal')">
    <div class="modal-sheet">
        <div class="modal-handle"></div>
        <div class="modal-title" id="chal-title">TOURNAMENT</div>
        <p class="modal-subtitle">Confirm your entry details below.</p>
        
        <div class="match-details-box">
            <div class="match-detail-row">
                <span class="match-detail-label">Entry Fee</span>
                <span class="match-detail-value neon">KES <span id="chal-fee">0</span></span>
            </div>
            <div class="match-detail-row">
                <span class="match-detail-label">Your Balance</span>
                <span class="match-detail-value">KES <span id="chal-bal">0</span></span>
            </div>
        </div>

        <div class="balance-insufficient" id="chal-error">
            Insufficient balance. Please deposit funds to join.
        </div>

        <button class="btn-mpesa" id="chal-btn" onclick="confirmChallenge()">CONFIRM & JOIN</button>
        <button class="btn-cancel" onclick="closeModal('challenge-modal')">Cancel</button>
    </div>
</div>

<!-- Room Code Modal (for successful join) -->
<div class="modal-overlay" id="room-modal" onclick="handleOverlayClick(event, 'room-modal')">
    <div class="modal-sheet">
        <div class="modal-handle"></div>
        <div class="room-reveal-box">
            <div class="step-icon success" style="margin-bottom: 20px;">üèüÔ∏è</div>
            <div class="modal-title">JOIN SUCCESSFUL</div>
            <p class="modal-subtitle">Your room code is ready. Share it with your opponent.</p>
            <div class="room-code-display" id="room-code-display">KE-XXXX</div>
            <button class="btn-whatsapp" onclick="shareRoomCode()">üì≤ Share on WhatsApp</button>
            <button class="btn-done" style="margin-top: 20px;" onclick="closeModal('room-modal')">CLOSE</button>
        </div>
    </div>
</div>

<script>
    // --- Global variables ---
    let authToken = localStorage.getItem('supabaseToken');
    let currentUser = null;
    let currentBalance = 0;
    let currentPhone = '';
    let currentUsername = '';
    let currentCheckoutId = null; // for deposit polling
    let pollInterval = null;

    // --- Utility functions ---
    function showError(elementId, message) {
        const el = document.getElementById(elementId);
        if (el) {
            el.textContent = message;
            el.style.display = 'block';
        }
    }

    function hideError(elementId) {
        const el = document.getElementById(elementId);
        if (el) el.style.display = 'none';
    }

    async function fetchWithAuth(url, options = {}) {
        if (!authToken) {
            window.location.href = '/login';
            return;
        }
        const headers = {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`,
            ...options.headers
        };
        const res = await fetch(url, { ...options, headers });
        if (res.status === 401) {
            // Token expired or invalid
            localStorage.removeItem('supabaseToken');
            localStorage.removeItem('supabaseUser');
            window.location.href = '/login';
            return;
        }
        return res;
    }

    // --- Load user data and balance ---
    async function loadDashboard() {
        try {
            // Get user from localStorage
            const userStr = localStorage.getItem('supabaseUser');
            if (!userStr) throw new Error('No user data');
            currentUser = JSON.parse(userStr);
            
            // Set username and avatar
            currentUsername = currentUser.user_metadata?.username || currentUser.phone?.substring(0,8) || 'Player';
            document.getElementById('username-display').innerText = '@' + currentUsername;
            document.getElementById('avatar-letter').innerText = currentUsername.charAt(0).toUpperCase();
            
            // Format phone for display
            if (currentUser.phone) {
                let phone = currentUser.phone.replace('+254', '0');
                document.getElementById('phone-display').innerText = phone;
                currentPhone = phone;
                // Pre-fill deposit phone input
                document.getElementById('deposit-phone').value = phone;
                document.getElementById('withdraw-phone').value = phone;
            }

            // Load balance
            await refreshBalance();

            // Load tournaments
            await loadTournaments();

            // Hide loading screen
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
        } catch (err) {
            console.error('Failed to load dashboard', err);
            window.location.href = '/login';
        }
    }

    async function refreshBalance() {
        const res = await fetchWithAuth('/wallet/balance');
        if (!res) return;
        const data = await res.json();
        currentBalance = data.balance || 0;
        updateBalanceDisplay();
    }

    function updateBalanceDisplay() {
        const balElement = document.getElementById('balance');
        balElement.innerText = currentBalance.toFixed(2);
        balElement.classList.remove('balance-flash');
        void balElement.offsetWidth;
        balElement.classList.add('balance-flash');
    }

    // --- TOURNAMENTS (UPDATED) ---
    async function loadTournaments() {
        try {
            const res = await fetch('/tournaments');
            if (!res.ok) throw new Error('Failed to load tournaments');
            const tournaments = await res.json();
            renderTournaments(tournaments);
        } catch (err) {
            console.error('Error loading tournaments:', err);
            document.getElementById('tournament-list').innerHTML = 
                '<div class="tournament-card"><div class="t-name">Failed to load tournaments</div></div>';
        }
    }

    function renderTournaments(tournaments) {
        const container = document.getElementById('tournament-list');
        if (!tournaments || tournaments.length === 0) {
            container.innerHTML = '<div class="tournament-card"><div class="t-name">No active tournaments</div></div>';
            return;
        }

        let html = '';
        tournaments.forEach(t => {
            const isLive = t.status === 'live';
            const badgeClass = isLive ? 'live-badge' : 'soon-badge';
            
            // Format start time nicely
            const startTime = new Date(t.start_time);
            const timeStr = isLive 
                ? '<div class="live-pip"></div> Live' 
                : '‚è∞ ' + startTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const fillPercent = (t.current_players / t.max_players) * 100;
            // Use prize_pool from API if available, otherwise calculate
            const prize = t.prize_pool || (t.entry_fee * t.max_players);

            html += `
                <div class="tournament-card ${isLive ? 'live' : ''}">
                    <div class="t-header">
                        <div>
                            <div class="t-name">${t.name}</div>
                            <div class="t-meta">Entry: KES ${t.entry_fee}</div>
                        </div>
                        <div class="t-badge ${badgeClass}">${timeStr}</div>
                    </div>
                    <div class="t-footer">
                        <div class="t-prize">
                            <small>Prize Pool</small> KES ${prize.toLocaleString()}
                        </div>
                        <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px;">
                            <div class="t-players">üë• ${t.current_players} / ${t.max_players} players</div>
                            <button class="btn-join" onclick="openChallengeModal('${t.id}', '${t.name}', ${t.entry_fee})">
                                Join ‚Äî KES ${t.entry_fee}
                            </button>
                        </div>
                    </div>
                    <div class="progress-bar"><div class="progress-fill" style="width:${fillPercent}%"></div></div>
                </div>
            `;
        });
        container.innerHTML = html;
    }

    // --- Modal Helpers ---
    function handleOverlayClick(e, modalId) {
        if (e.target.id === modalId) closeModal(modalId);
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('open');
        if (modalId === 'deposit-modal' && pollInterval) {
            clearInterval(pollInterval);
            pollInterval = null;
        }
    }

    function switchStep(modalId, stepNum) {
        const modal = document.getElementById(modalId);
        modal.querySelectorAll('.modal-step').forEach(step => step.classList.remove('active'));
        document.getElementById(`${modalId.split('-')[0]}-step-${stepNum}`).classList.add('active');
    }

    // --- Deposit Flow ---
    function openDepositModal() {
        switchStep('deposit-modal', 1);
        document.getElementById('deposit-amount').value = '';
        document.getElementById('deposit-error').style.display = 'none';
        clearPresets();
        document.getElementById('deposit-modal').classList.add('open');
    }

    function selectPreset(btn, amount) {
        clearPresets();
        btn.classList.add('selected');
        document.getElementById('deposit-amount').value = amount;
    }

    function clearPresets() {
        const presets = document.querySelectorAll('#deposit-presets .preset-btn');
        presets.forEach(p => p.classList.remove('selected'));
    }

    async function processDeposit() {
        const amount = parseFloat(document.getElementById('deposit-amount').value);
        const phone = document.getElementById('deposit-phone').value.trim();
        if (!amount || amount < 50) return showError('deposit-error', 'Minimum deposit is KES 50');
        if (!phone) return showError('deposit-error', 'Please enter your M-PESA number');

        hideError('deposit-error');
        document.getElementById('depositBtn').disabled = true;

        try {
            const res = await fetchWithAuth('/mpesa/deposit', {
                method: 'POST',
                body: JSON.stringify({ phone, amount, description: 'Vumbua Deposit' })
            });
            if (!res) return;
            const data = await res.json();
            if (!res.ok) throw new Error(data.error || 'Deposit failed');

            currentCheckoutId = data.checkoutId;
            switchStep('deposit-modal', 2);
            // Start polling for status
            pollInterval = setInterval(() => checkDepositStatus(currentCheckoutId), 2000);
        } catch (err) {
            showError('deposit-error', err.message);
        } finally {
            document.getElementById('depositBtn').disabled = false;
        }
    }

    async function checkDepositStatus(checkoutId) {
        try {
            const res = await fetch(`/mpesa/status?checkoutId=${checkoutId}`);
            const data = await res.json();
            if (data.status === 'success') {
                clearInterval(pollInterval);
                pollInterval = null;
                await refreshBalance();
                document.getElementById('success-deposit-val').innerText = data.amount || '...';
                switchStep('deposit-modal', 3);
            } else if (data.status === 'failed' || data.status === 'cancelled') {
                clearInterval(pollInterval);
                pollInterval = null;
                document.getElementById('deposit-fail-reason').innerText = 'Transaction was not completed.';
                switchStep('deposit-modal', 4);
            }
            // else still pending, continue polling
        } catch (err) {
            console.error('Polling error', err);
        }
    }

    // --- Withdraw Flow ---
    function openWithdrawModal() {
        switchStep('withdraw-modal', 1);
        document.getElementById('withdraw-max').innerText = currentBalance.toFixed(2);
        document.getElementById('withdraw-amount').value = '';
        document.getElementById('withdraw-error').style.display = 'none';
        if (currentPhone) document.getElementById('withdraw-phone').value = currentPhone;
        document.getElementById('withdraw-modal').classList.add('open');
    }

    async function processWithdraw() {
        const amount = parseFloat(document.getElementById('withdraw-amount').value);
        const phone = document.getElementById('withdraw-phone').value.trim();
        const name = document.getElementById('withdraw-name').value.trim();
        const errElement = document.getElementById('withdraw-error');
        
        if (!amount || amount < 100) {
            errElement.innerText = 'Minimum withdrawal is KES 100';
            errElement.style.display = 'block';
            return;
        }
        if (amount + 15 > currentBalance) {
            errElement.innerText = 'Insufficient balance (Amount + KES 15 Fee)';
            errElement.style.display = 'block';
            return;
        }
        if (!phone || !name) {
            errElement.innerText = 'Please fill all fields';
            errElement.style.display = 'block';
            return;
        }

        hideError('withdraw-error');
        document.getElementById('withdrawBtn').disabled = true;

        try {
            const res = await fetchWithAuth('/wallet/withdraw', {
                method: 'POST',
                body: JSON.stringify({ amount, phone, name })
            });
            if (!res) return;
            const data = await res.json();
            if (!res.ok) throw new Error(data.error || 'Withdrawal failed');

            // Update local balance (backend already deducted)
            currentBalance -= (amount + 15);
            updateBalanceDisplay();

            document.getElementById('success-withdraw-val').innerText = amount;
            switchStep('withdraw-modal', 2);
        } catch (err) {
            showError('withdraw-error', err.message);
        } finally {
            document.getElementById('withdrawBtn').disabled = false;
        }
    }

    // --- Tournament/Challenge Flow ---
    let currentTournamentId = null;
    let currentTournamentFee = 0;
    let currentTournamentName = '';

    function openChallengeModal(tournamentId, name, fee) {
        currentTournamentId = tournamentId;
        currentTournamentName = name;
        currentTournamentFee = fee;
        document.getElementById('chal-title').innerText = name.toUpperCase();
        document.getElementById('chal-fee').innerText = fee;
        document.getElementById('chal-bal').innerText = currentBalance.toFixed(2);
        document.getElementById('chal-error').style.display = 'none';
        document.getElementById('challenge-modal').classList.add('open');
    }

    async function confirmChallenge() {
        if (currentBalance < currentTournamentFee) {
            document.getElementById('chal-error').style.display = 'block';
            return;
        }

        const btn = document.getElementById('chal-btn');
        btn.disabled = true;
        btn.textContent = 'Processing...';

        try {
            const res = await fetchWithAuth('/tournament/join', {
                method: 'POST',
                body: JSON.stringify({
                    tournamentId: currentTournamentId,
                    entryFee: currentTournamentFee,
                    paymentMethod: 'wallet'
                })
            });
            if (!res) return;
            const data = await res.json();
            if (!res.ok) throw new Error(data.error || 'Join failed');

            // Update balance (backend already deducted)
            currentBalance -= currentTournamentFee;
            updateBalanceDisplay();

            closeModal('challenge-modal');
            document.getElementById('room-code-display').innerText = data.roomCode;
            document.getElementById('room-modal').classList.add('open');
        } catch (err) {
            alert(err.message);
        } finally {
            btn.disabled = false;
            btn.textContent = 'CONFIRM & JOIN';
        }
    }

    // --- Friend Code Generation (unchanged) ---
    function generateFriendCode() {
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        const nums = "0123456789";
        let code = "KE-";
        for(let i=0; i<2; i++) code += letters.charAt(Math.floor(Math.random() * letters.length));
        for(let i=0; i<2; i++) code += nums.charAt(Math.floor(Math.random() * nums.length));
        
        document.getElementById('code-display').style.display = 'none';
        document.getElementById('generated-code').innerText = code;
        document.getElementById('code-reveal').style.display = 'block';
    }

    function shareToWhatsApp() {
        const code = document.getElementById('generated-code').innerText;
        const text = encodeURIComponent(`Come play me on Vumbua eFootball! My challenge room code is ${code}. Play here: https://vumbua.app`);
        window.open(`https://wa.me/?text=${text}`, '_blank');
    }

    function shareRoomCode() {
        const code = document.getElementById('room-code-display').innerText;
        const text = encodeURIComponent(`Join my match on Vumbua eFootball! Room code: ${code}. Play here: https://vumbua.app`);
        window.open(`https://wa.me/?text=${text}`, '_blank');
    }

    // --- Logout ---
    document.getElementById('logoutBtn').addEventListener('click', () => {
        localStorage.removeItem('supabaseToken');
        localStorage.removeItem('supabaseUser');
        window.location.href = '/login';
    });

    // --- Initial load ---
    window.onload = () => {
        if (!authToken) {
            window.location.href = '/login';
            return;
        }
        loadDashboard();
    };
</script>
</body>
</html>